<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<title>Revisión de Canales Operativos</title>
<script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>

<style>
  h2 { text-align:center; margin:20px 0; position: relative; z-index:1; }
  .controls { margin-bottom:15px; text-align:center; background-color: rgba(255,255,255,0.9); padding:10px; z-index:1; position: relative; }
  .canales-container { display: flex; flex-wrap: wrap; justify-content: space-between; background-color: rgba(255,255,255,0.95); padding:10px; }
  .canal-item { width: 48%; margin-bottom: 5px; display: flex; align-items: center; border:1px solid #ccc; padding:5px; border-radius:5px; background: #fff; }
  .canal-item span { flex:1; font-weight:bold; }
  .canal-item input[type="text"] { flex:1; margin-left:5px; text-align:center; }
  .checkbox { margin-left:10px; transform: scale(1.2); cursor:pointer; }
  button { margin:5px; padding:8px 12px; background:#2196F3; color:white; border:none; border-radius:5px; cursor:pointer; }
  button:hover { background:#1976D2; }
</style>
</head>

<body>

<h2>Revisión de Canales Operativos</h2>

<div class="controls">
  <label for="tecnico">Técnico Responsable:</label>
  <select id="tecnico">
    <option value="">Seleccione</option>
    <option>FRANCISCO C</option>
    <option>RONALD G</option>
    <option>WILTON M</option>
    <option>ANDY O</option>
  </select>
  
  <label for="fecha">Fecha:</label>
  <input type="date" id="fecha">
  
  <button onclick="marcarTodos()">Marcar Todos Activos</button>
  <button onclick="guardarObservaciones()">Guardar Observaciones</button>
  <button onclick="descargarReporte()">Descargar Imagen</button>
</div>

<div class="canales-container" id="canalesContainer"></div>

<script>
const canales = [
  "ECUAVISA","EL TRECE","RTS","TELEAMAZONAS","COSTATV","ECUADORTV","GAMA TV",
  "ANTENA 3 SERIES","TCTELEVISION","TVC","AZTECA UNO","OROMAR","RTU","TELESUR",
  "HISPANTV","VOLVER","A&E","NICK MUSIC","ESPN HD","ESPN 2","FOXSPORTS 3",
  "ESPN 3","ESPN 4","ESPN 5","HISTORY","HISTORY 2","EUROCHANEL","HBO","ZOOMOO",
  "NICKELODEON","DREAMW","NICK JR","TEEN NICK","CARTOONITO","CARTOON NETWORK",
  "TOONCAST","SPACE","SONY","SONY MOVIES","A3 CINEMA","STUDIO UNIVERSAL",
  "UNIVERSAL","FILM &ARTS","COMEDY CENTRAL","USA","TNT SERIES","PARAMOUNT",
  "VENEVISION","AXN","CINECANAL","AMC","HOLATV","TNT","CINEMA PLATINO",
  "PANICO TV","CINEMEXICANO","TRAVELXP","MTV 80 S","MTV","MTV HITS","CARACOL",
  "Q MUSICA","VIDEOROLA","GOURMET","LIFETIME","DISCOVERY CHANNEL","E!","RCN",
  "CANAL DE LAS ESTRELLAS - Problemas sintonización","TELEMUNDO","PASIONES",
  "TELENOVELAS","VENE PLUS","CITY TV","TELEFE","SEÑAL COLOMBIA","NUESTRO TIEMPO",
  "ENLACE","EWTN","TELEVEN"
];

document.getElementById('fecha').valueAsDate = new Date();

// Crear los canales (empieza en número 2)
const container = document.getElementById('canalesContainer');
canales.forEach((nombre, index) => {
  const numero = index + 2;
  const div = document.createElement('div');
  div.className = 'canal-item';
  div.innerHTML = `
    <span>${numero.toString().padStart(2,'0')} - ${nombre}</span>
    <input type="checkbox" class="checkbox" data-numero="${numero}" data-canal="${nombre}">
    <input type="text" class="observacion" placeholder="" data-numero="${numero}" data-canal="${nombre}" oninput="soloTexto(this)">
  `;
  container.appendChild(div);
});

function marcarTodos(){
  document.querySelectorAll('.checkbox').forEach(cb => cb.checked = true);
}

function soloTexto(input){
  input.value = input.value.replace(/[^a-zA-ZáéíóúÁÉÍÓÚñÑ\s]/g,'') .toUpperCase();
}

// Enviar canal + número + observación
async function guardarObservaciones(){
  const observaciones = [];

  document.querySelectorAll('.observacion').forEach(input => {
    const numero = input.dataset.numero;
    const canal = input.dataset.canal;
    const texto = input.value.trim();

    if (texto !== "") {
      observaciones.push({
        numero: numero,
        canal: canal,
        observacion: texto
      });
    }
  });

  if (observaciones.length === 0) {
    alert("⚠️ No hay observaciones para guardar.");
    return;
  }

  const scriptURL = "https://script.google.com/macros/s/AKfycbwkBCjhdaWuOlUndsNR16Q8DBF-67ZO-BozekRGKWIWiXZjotcloXpcQ4qYSWGF2QAksA/exec";

  try {
    await fetch(scriptURL, {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify(observaciones),
      mode: "no-cors"
    });
    alert("✅ Observaciones guardadas correctamente en Google Sheets.");
  } catch (error) {
    alert("❌ Error al guardar: " + error.message);
  }
}

function descargarReporte(){
  html2canvas(document.body).then(canvas => {
    const link = document.createElement('a');
    const tecnico = document.getElementById('tecnico').value || 'sin_tecnico';
    const fecha = document.getElementById('fecha').value || 'sin_fecha';
    link.download = `reporte_${tecnico}_${fecha}.png`;
    link.href = canvas.toDataURL();
    link.click();
  });
}
</script>

</body>
</html>






